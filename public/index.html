<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTodo - Responsive Task Manager</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.loli.net">
    <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>
    <link
        href="https://fonts.loli.net/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i data-lucide="check-circle" style="color: var(--primary);"></i>
                <h2>MyTodo</h2>
                <button class="menu-trigger mobile-only" onclick="toggleSidebar()" style="margin-left:auto;">
                    <i data-lucide="chevron-left"></i>
                </button>
            </div>

            <div class="categories">
                <div class="section-label" data-i18n="categories">Categories</div>
                <div id="category-list"></div>
                <div class="add-category-btn" onclick="openAddCategoryModal()">
                    <i data-lucide="plus-circle" size="16"></i>
                    <span data-i18n="addCategory">Add Category</span>
                </div>

                <div class="section-label" data-i18n="archive">Archive</div>
                <div class="category-item" id="archive-menu-item" onclick="switchCategory('archive')">
                    <i data-lucide="archive" size="18"></i>
                    <span data-i18n="archivedTasks">Archived Tasks</span>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="category-item" onclick="openSettings()">
                    <i data-lucide="settings" size="18"></i>
                    <span data-i18n="settings">Settings</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="list-header">
                <div class="header-left">
                    <button class="menu-trigger" onclick="toggleSidebar()">
                        <i data-lucide="menu" size="24"></i>
                    </button>
                    <h1 id="current-category-title">All Tasks</h1>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle-btn" onclick="cycleTheme()" id="theme-toggle-btn">
                        <i id="theme-toggle-icon" data-lucide="monitor" size="18"></i>
                        <span id="theme-toggle-label" class="theme-label">SYS</span>
                    </button>
                </div>
            </header>

            <div id="todo-list" class="todo-list"></div>

            <button id="fab-add-btn" class="fab-btn" onclick="openAddTaskModal()">
                <i data-lucide="plus"></i>
            </button>
        </main>
    </div>

    <!-- Modals -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="editTask">Edit Task</h2>
            </div>
            <div class="modal-body">
                <div class="form-field"><label data-i18n="taskName">Task Name</label><input type="text"
                        id="edit-task-name"></div>
                <div class="form-field"><label data-i18n="category">Category</label><select
                        id="edit-task-category"></select></div>
                <div class="form-field">
                    <label data-i18n="deadline">Deadline</label>
                    <div class="datetime-input-group">
                        <input type="date" id="edit-task-date" class="date-input">
                        <input type="time" id="edit-task-time" class="time-input">
                    </div>
                </div>
                <div class="form-field">
                    <label data-i18n="priority">Priority</label>
                    <select id="edit-task-priority">
                        <option value="low" data-i18n="low">Low</option>
                        <option value="medium" data-i18n="medium">Medium</option>
                        <option value="high" data-i18n="high">High</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()" data-i18n="cancel">Cancel</button>
                <button class="btn-primary" id="save-edit-btn" data-i18n="save">Save</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="settings">Settings</h2>
            </div>
            <div class="modal-body">
                <div class="form-field"><label data-i18n="theme">Theme</label><select id="settings-theme"
                        onchange="applyTheme(this.value)">
                        <option value="system">System</option>
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select></div>
                <div class="form-field"><label data-i18n="language">Language</label><select id="settings-lang"
                        onchange="applyLanguage(this.value)">
                        <option value="en">English</option>
                        <option value="zh">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                    </select></div>
                <hr style="border:0; border-top:1px solid var(--border-color); margin:10px 0;">
                <div class="form-field">
                    <label data-i18n="dataOps">Data Management</label>

                    <div style="display:flex; gap:10px; margin-top:5px;">
                        <button class="btn-secondary" onclick="exportData()" style="flex:1;"><i data-lucide="download"
                                size="14"></i> <span data-i18n="export">Export</span></button>
                        <button class="btn-secondary" onclick="document.getElementById('import-file').click()"
                            style="flex:1;"><i data-lucide="upload" size="14"></i> <span
                                data-i18n="import">Import</span></button>
                        <input type="file" id="import-file" style="display:none;" accept=".json"
                            onchange="importData(this)">
                    </div>
                </div>

                <!-- Cloud Sync Section -->
                <div class="form-field">
                    <label data-i18n="cloudSync">Cloud Sync</label>
                    <div class="sync-toggle-row">
                        <span class="sync-toggle-label" data-i18n="enableSync">Enable Gist Sync</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="sync-enabled" onchange="toggleSyncEnabled()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div id="sync-config-preview" class="sync-config-preview" style="display:none;">
                        <div class="sync-status">
                            <span class="sync-platform" id="sync-platform-display">GitHub</span>
                            <span class="sync-time" id="sync-time-display" data-i18n="notSynced">Not synced</span>
                        </div>
                        <button class="btn-secondary btn-sm" onclick="openSyncModal()">
                            <i data-lucide="settings" size="14"></i>
                            <span data-i18n="syncConfig">Sync Config</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-primary" onclick="closeSettings()"
                    data-i18n="close">Close</button></div>
        </div>
    </div>

    <!-- Sync Config Modal -->
    <div id="sync-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="syncConfigTitle">Sync Config</h2>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label data-i18n="syncType">Type</label>
                    <select id="sync-type">
                        <option value="github">GitHub</option>
                        <option value="gitee">Gitee</option>
                    </select>
                </div>
                <div class="form-field">
                    <label data-i18n="syncToken">Token</label>
                    <div class="input-with-action">
                        <input type="password" id="sync-token" placeholder="ghp_xxxx or gitee token">
                        <button class="btn-icon" onclick="toggleTokenVisibility()">
                            <i id="token-visibility-icon" data-lucide="eye" size="18"></i>
                        </button>
                    </div>
                    <small class="form-hint" data-i18n="tokenHint">Personal access token with gist permissions</small>
                </div>
                <div class="form-field">
                    <label data-i18n="syncGistId">Gist ID</label>
                    <input type="text" id="sync-gist-id" placeholder="Leave empty to create new">
                    <small class="form-hint" data-i18n="gistIdHint">Existing Gist ID or leave empty to
                        auto-create</small>
                </div>
                <div class="form-field">
                    <div class="checkbox-row">
                        <input type="checkbox" id="sync-encrypt" checked>
                        <label for="sync-encrypt" data-i18n="encryptData">Encrypt data with token</label>
                    </div>
                </div>

                <div class="sync-actions">
                    <button class="btn-sync btn-upload" onclick="uploadToGist()">
                        <i data-lucide="upload-cloud" size="18"></i>
                        <span data-i18n="uploadConfig">Upload</span>
                    </button>
                    <button class="btn-sync btn-download" onclick="downloadFromGist()">
                        <i data-lucide="download-cloud" size="18"></i>
                        <span data-i18n="downloadConfig">Download</span>
                    </button>
                </div>

                <div id="sync-status-message" class="sync-status-message" style="display:none;"></div>

                <div class="sync-last-time">
                    <span data-i18n="lastSyncTime">Last sync time:</span>
                    <span id="last-sync-time">--</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeSyncModal()" data-i18n="cancel">Cancel</button>
                <button class="btn-primary" onclick="saveSyncConfig()" data-i18n="save">Save</button>
            </div>
        </div>
    </div>

    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="addCategory">Add Category</h2>
            </div>
            <div class="modal-body">
                <div class="form-field"><label data-i18n="categoryName">Name</label><input type="text"
                        id="new-category-name"></div>
                <div class="form-field">
                    <label data-i18n="categoryIcon">Icon</label>
                    <select id="new-category-icon">
                        <option value="hash" data-i18n="iconDefault"># (Default)</option>
                        <option value="briefcase" data-i18n="iconWork">üíº Work</option>
                        <option value="user" data-i18n="iconPersonal">üë§ Personal</option>
                        <option value="shopping-cart" data-i18n="iconShopping">üõí Shopping</option>
                        <option value="book" data-i18n="iconStudy">üìö Study</option>
                        <option value="heart" data-i18n="iconHealth">‚ù§Ô∏è Health</option>
                        <option value="home" data-i18n="iconHome">üè† Home</option>
                        <option value="plane" data-i18n="iconTravel">‚úàÔ∏è Travel</option>
                        <option value="coffee" data-i18n="icon‰ºëÈó≤">‚òï Cafe</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-secondary" onclick="closeCategoryModal()"
                    data-i18n="cancel">Cancel</button><button class="btn-primary" onclick="addCategory()"
                    data-i18n="add">Add</button></div>
        </div>
    </div>

    <div id="add-task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="addTask">Add Task</h2>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label data-i18n="taskName">Task Name</label>
                    <input type="text" id="new-task-input" placeholder="What needs to be done?"
                        data-i18n-placeholder="todoPlaceholder">
                </div>
                <div class="form-field">
                    <label data-i18n="category">Category</label>
                    <select id="new-task-category"></select>
                </div>
                <div class="form-field">
                    <label data-i18n="deadline">Deadline</label>
                    <div class="datetime-input-group">
                        <input type="date" id="new-task-date" class="date-input">
                        <input type="time" id="new-task-time" class="time-input">
                    </div>
                </div>
                <div class="form-field">
                    <label data-i18n="priority">Priority</label>
                    <select id="new-task-priority">
                        <option value="low" data-i18n="low">Low</option>
                        <option value="medium" data-i18n="medium" selected>Medium</option>
                        <option value="high" data-i18n="high">High</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAddTaskModal()" data-i18n="cancel">Cancel</button>
                <button class="btn-primary" id="add-task-confirm-btn" data-i18n="add">Add</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="confirmDeleteTitle">Confirm</h2>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-text"></p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeConfirmModal()" data-i18n="cancel">Cancel</button>
                <button class="btn-primary btn-danger" id="confirm-delete-btn" data-i18n="delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <h2 id="alert-title" data-i18n="info">Info</h2>
            <p id="alert-message" style="margin: 20px 0; font-size: 16px;"></p>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeAlertModal()" data-i18n="close">Close</button>
            </div>
        </div>
    </div>

    <!-- Generic Confirm Modal -->
    <div id="generic-confirm-modal" class="modal">
        <div class="modal-content">
            <h2 id="generic-confirm-title" data-i18n="confirm">Confirm</h2>
            <p id="generic-confirm-message" style="margin: 20px 0; font-size: 16px;"></p>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGenericConfirmModal()"
                    data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="generic-confirm-btn" data-i18n="ok">OK</button>
            </div>
        </div>
    </div>
    <script src="app.js"></script>
</body>

</html>